(()=>{"use strict";const t=1200,e=800;let s,i,h,o,r,n,a=0,l=0,d=[];function u(){i.fillStyle="black",i.fillRect(0,0,t,e)}function c(t){a=(t-l)/1e3,l=t,h=Math.round(1/a),u();for(let t=0;t<d.length;t++)d[t].Update(a);p(),r.CheckGameState();for(let t=0;t<d.length;t++)d[t].Render();window.requestAnimationFrame(c)}document.addEventListener("DOMContentLoaded",(function(){s=document.getElementById("my-canvas"),i=s.getContext("2d"),s.width=t,s.height=e,u(),o=new P,n=new S,r=new m,document.body.addEventListener("keydown",(t=>{n.KeyDown(t.keyCode)})),document.body.addEventListener("keyup",(t=>{n.KeyUp(t.keyCode)})),r.Init(),window.requestAnimationFrame(c)}));const p=()=>{let t,e;for(let t=0;t<d.length;t++){const e=d[t];e instanceof x&&e.SetColliding(!1)}for(let a=d.length-1;a>=0;a--)if(t=d[a],t instanceof x)for(let l=d.length-1;l>=0;l--)if(e=d[l],e instanceof x&&a!==l&&(s=t.x,i=t.y,h=t.GetCollisionRadius(),o=e.x,r=e.y,n=e.GetCollisionRadius(),(s-o)*(s-o)+(i-r)*(i-r)<=(h+n)*(h+n))){if((t instanceof M||e instanceof M)&&(t instanceof C||e instanceof C))return;t.SetColliding(!0),e.SetColliding(!0),(t instanceof M||e instanceof M)&&(t instanceof A||e instanceof A)&&(t instanceof A&&e instanceof M&&(e.Remove(),t.ScoredHit()),e instanceof A&&t instanceof M&&(t.Remove(),e.ScoredHit()))}var s,i,h,o,r,n};function f(t){d=d.filter((e=>!(e instanceof t)))}class m{constructor(){this.gameState="START",this.currentLevel=1,this.currentLives=0,this.currentScore=0,this.currentAsteroids=0,this.bonusLivesScore=25,this.isSoundEnabled=o.CheckAudioEnabled(),this.gameOverSound=o.CreateSound("gameOver"),this.missionCompleteSound=o.CreateSound("missionComplete"),this.levelData={1:{bigAsteroids:6,mediumAsteroids:0,smallAsteroids:0},2:{bigAsteroids:7,mediumAsteroids:2,smallAsteroids:0},3:{bigAsteroids:8,mediumAsteroids:4,smallAsteroids:3},4:{bigAsteroids:9,mediumAsteroids:6,smallAsteroids:6},5:{bigAsteroids:10,mediumAsteroids:8,smallAsteroids:9}},this.player=void 0,this.playerRespawnTime=2}Init(){d.push(new w),d.push(new g),d.push(new E("Asteroids","Press Enter To Start")),this.SpawnAsteroids(10)}CheckGameState(){const t=n.GetCurrentActions();switch(this.gameState){case"START":case"GAME_OVER":t.startButton&&(f(E),this.NewGame());break;case"LEVEL_SETUP":break;case"LEVEL_RUNNING":if(this.TrackAsteroids(),0==this.currentAsteroids){if(this.currentLevel==Object.keys(this.levelData).length)return this.GameOver();this.LevelComplete()}break;case"LEVEL_COMPLETE":t.startButton&&(f(E),this.NextLevel());break;default:console.log("GameState Error.")}}GetGameState(){return this.gameState}GetCurrentAsteroids(){return this.currentAsteroids}GetCurrentScore(){return this.currentScore}GetCurrentLives(){return this.currentLives}IsSoundEnabled(){return this.isSoundEnabled}NewGame(){this.gameState="LEVEL_SETUP",this.currentLevel=1,this.currentScore=0,this.LevelSetup()}LevelComplete(){this.gameState="LEVEL_COMPLETE",this.player&&this.player.CleanUpEffects(),f(C),this.AddScore(this.currentLives*this.bonusLivesScore),d.push(new E(`LEVEL ${this.currentLevel} COMPLETE`,"Press Enter To Continue."))}NextLevel(){this.gameState="LEVEL_SETUP",this.currentLevel+=1,this.LevelSetup()}GameOver(){if(this.player&&this.player.CleanUpEffects(),f(C),this.currentLevel==Object.keys(this.levelData).length)return this.gameState="GAME_OVER",this.missionCompleteSound.Play(),d.push(new E("MISSION COMPLETE","Press Enter To Play Again","lime"));this.gameState="GAME_OVER",d.push(new E("GAME OVER","Press Enter To Try Again","red")),this.gameOverSound.Play()}AddScore(t){this.currentScore+=t}ShipDestroyed(){if(this.currentLives-=1,this.currentLives<=0)return this.GameOver();f(C),this.NewShip()}LevelSetup(){f(A),f(C),this.currentLives=3,this.currentAsteroids=0;const t=this.levelData[this.currentLevel];this.SpawnAsteroids(t.bigAsteroids,1),this.SpawnAsteroids(t.mediumAsteroids,2),this.SpawnAsteroids(t.smallAsteroids,3),this.NewShip(0),this.gameState="LEVEL_RUNNING"}SpawnAsteroids(t,e=1){for(let s=0;s<t;s++)d.push(new A(e))}TrackAsteroids(){let t=0;for(let e=0;e<d.length;e++)d[e]instanceof A&&(t+=1);this.currentAsteroids=t}NewShip(t=this.playerRespawnTime){this.player=new C(t),d.push(this.player)}}class S{constructor(){this.actions={leftButton:!1,rightButton:!1,forwardButton:!1,fireButton:!1,startButton:!1}}KeyDown(t){38!==t&&87!=t||(this.actions.forwardButton=!0),37!==t&&65!=t||(this.actions.leftButton=!0),39!==t&&68!=t||(this.actions.rightButton=!0),32===t&&(this.actions.fireButton=!0),13===t&&(this.actions.startButton=!0)}KeyUp(t){38!==t&&87!==t||(this.actions.forwardButton=!1),37!==t&&65!==t||(this.actions.leftButton=!1),39!==t&&68!==t||(this.actions.rightButton=!1),32===t&&(this.actions.fireButton=!1),13===t&&(this.actions.startButton=!1)}GetCurrentActions(){return this.actions}}class y{constructor(t,e){this.x=t,this.y=e}Update(t){}Render(){}}class v extends y{constructor(t,e){super(t,e),this.color="white"}}class E extends v{constructor(t,e,s="white",i="white"){super(0,0),this.font1="50px Arial",this.font2="20px Arial",this.text1=t||"Foo",this.text2=e||"Bar",this.text1Color=s,this.text2Color=i}Update(t){}Render(){i.fillStyle=this.text1Color,i.font=this.font1,i.fillText(this.text1,(t-i.measureText(this.text1).width)/2,e/2),i.fillStyle=this.text2Color,i.font=this.font2,i.fillText(this.text2,(t-i.measureText(this.text2).width)/2,e/2+40)}}class g extends v{constructor(){super(0,0),this.score=r.GetCurrentScore()}Update(t){this.score=r.GetCurrentScore()}Render(){i.strokeStyle=this.color,i.fillStyle="white",i.font="20px Arial",i.fillText("SCORE: "+this.score.toString(),20,35)}}class w extends v{constructor(){super(1175,10),this.lives=r.GetCurrentLives(),this.color="lime"}Update(t){this.lives=r.GetCurrentLives()}Render(){let t=[[9,9],[-9,9]],e=this.x;i.strokeStyle=this.color;for(let s=0;s<this.lives;s++){i.beginPath(),i.moveTo(e,this.y);for(let s=0;s<t.length;s++)i.lineTo(e+t[s][0],this.y+t[s][1]);i.closePath(),i.stroke(),e-=30}}}class x extends y{constructor(t,e,s){super(t,e),this.collisionRadius=s,this.renderCollision=!1,this.isColliding=!1}Update(t){}Render(){this.renderCollision&&(i.beginPath(),i.strokeStyle=this.isColliding?"red":"yellow",i.arc(this.x,this.y,this.collisionRadius,0,2*Math.PI),i.closePath(),i.stroke())}GetCollisionStatus(){return this.isColliding}GetCollisionRadius(){return this.collisionRadius}SetColliding(t){this.isColliding=t}}class C extends x{constructor(s=0){const i=t/2,h=e/2;super(i,h,11),this.radius=15,this.speed=10,this.velocityX=0,this.velocityY=0,this.rotateSpeed=.1,this.shieldTimer=2,this.bulletTimer=0,this.bulletFireDelay=.2,this.shieldSoundEffect=o.CreateSound("shieldDown"),this.shipExplodeSoundEffect=o.CreateSound("shipExplode"),this.shipRespawnSoundEffect=o.CreateSound("shipRespawn"),this.thrusterSoundEffect=o.CreateSound("shipThrusters",!0),this.strokeColor="white",this.noseX=i+15,this.noseY=h,this.angle=Math.random(),this.dirModifier=0,this.respawnTimer=s,this.hasRespawned=!1,this.movingForward=!1,this.wasMovingForward=!1,this.jetX=this.x,this.jetY=this.y,this.jetEmitter=new R(this.jetX,this.jetY),d.push(this.jetEmitter)}Update(t){if(this.respawnTimer=Math.max(0,this.respawnTimer-t),this.respawnTimer>0)return;if(this.hasRespawned||(this.shipRespawnSoundEffect.Play(),this.hasRespawned=!0),super.Update(t),1==this.GetCollisionStatus()&&0==this.shieldTimer)return this.ShipWasHit();this.bulletTimer+=t;const e=n.GetCurrentActions();this.wasMovingForward=this.movingForward,this.movingForward=e.forwardButton,this.dirModifier=0,e.leftButton&&(this.dirModifier=-1),e.rightButton&&(this.dirModifier=1),e.fireButton&&this.bulletTimer>=this.bulletFireDelay&&(d.push(new M(this.noseX,this.noseY,this.angle)),this.bulletTimer=0);let i=this.angle/Math.PI*180;this.movingForward&&(this.velocityX+=Math.cos(i)*this.speed,this.velocityY+=Math.sin(i)*this.speed),this.wasMovingForward!==this.movingForward&&(this.movingForward&&(this.thrusterSoundEffect.Play(),this.jetEmitter.StartEmitting()),this.movingForward||(this.thrusterSoundEffect.Stop(),this.jetEmitter.StopEmitting())),this.x<this.radius&&(this.x=s.width),this.x>s.width&&(this.x=this.radius),this.y<this.radius&&(this.y=s.height),this.y>s.height&&(this.y=this.radius),this.velocityX*=Math.pow(.5,t),this.velocityY*=Math.pow(.5,t),this.angle+=this.rotateSpeed*this.dirModifier*t,this.x-=this.velocityX*t,this.y-=this.velocityY*t,this.jetX=this.x+this.radius/2*Math.cos(i),this.jetY=this.y+this.radius/2*Math.sin(i),this.jetEmitter.SetLocation(this.jetX,this.jetY,this.velocityX,this.velocityY);let h=this.shieldTimer;this.shieldTimer=Math.max(0,this.shieldTimer-t),h>this.shieldTimer&&0===this.shieldTimer&&this.shieldSoundEffect.Play()}Render(){if(this.respawnTimer>0)return;super.Render();let t=2*Math.PI/3,e=this.angle/Math.PI*180;i.strokeStyle=this.strokeColor,i.beginPath();for(let s=0;s<3;s++)i.lineTo(this.x-this.radius*Math.cos(t*s+e),this.y-this.radius*Math.sin(t*s+e));if(i.closePath(),i.stroke(),this.noseX=this.x-this.radius*Math.cos(e),this.noseY=this.y-this.radius*Math.sin(e),i.strokeStyle="red",i.beginPath(),i.arc(this.noseX,this.noseY,1.5,0,2*Math.PI),i.closePath(),i.stroke(),this.shieldTimer>0){let t=this.shieldTimer>1?.9:this.shieldTimer;i.beginPath(),i.strokeStyle=`rgba(0, 255, 255, ${t})`,i.arc(this.x,this.y,1.75*this.GetCollisionRadius(),0,2*Math.PI),i.closePath(),i.stroke()}}ShipWasHit(){this.shipExplodeSoundEffect.Play(),d.push(new k(this.x,this.y)),this.CleanUpEffects(),r.ShipDestroyed()}CleanUpEffects(){this.thrusterSoundEffect.Stop(),o.CleanUp(this.shipExplodeSoundEffect),o.CleanUp(this.thrusterSoundEffect),this.jetEmitter.Destroy()}}class M extends x{constructor(t,e,s){super(t,e,3),this.angle=s,this.height=4,this.width=4,this.speed=2e3,this.bulletSoundEffect=o.CreateSound("shootBullet"),this.soundPlayed=!1}Remove(){o.CleanUp(this.bulletSoundEffect);var t=d.indexOf(this);return d.splice(t,1)}Update(t){super.Update(t),this.soundPlayed||(this.bulletSoundEffect.Play(),this.soundPlayed=!0);var e=this.angle/Math.PI*180;this.x-=Math.cos(e)*this.speed*t,this.y-=Math.sin(e)*this.speed*t,(this.x<-25||this.y<-25||this.x>s.width+25||this.y>s.height+25)&&this.Remove()}Render(){super.Render(),i.fillStyle="pink",i.fillRect(this.x,this.y,this.width,this.height)}}class A extends x{constructor(s=1,i,h){const r={1:2.75*Math.random(),2:3.25*Math.random(),3:3.75*Math.random()};super(i||Math.floor(Math.random()*t),h||Math.floor(Math.random()*e),{1:46,2:22,3:12}[s]),this.asteroidScores={1:5,2:7,3:9},this.level=s||1,this.angle=Math.floor(328*Math.random()),this.strokeColor="rgb(180,138,113)",this.renderRotation=0,this.shotSoundEffect=o.CreateSound("asteroidExplode"),this.speed={1:200,2:240,3:275}[s],this.renderRotationSpeed=r[s],this.radius={1:50,2:25,3:15}[s]}ScoredHit(){if(this.shotSoundEffect.Play(),r.AddScore(this.asteroidScores[this.level]),d.push(new T(this.x,this.y,10,2,["brown"],1)),1===this.level||2===this.level){const t=this.level+1;d.push(new A(t,this.x-5,this.y-5)),d.push(new A(t,this.x+5,this.y+5))}o.CleanUp(this.shotSoundEffect);var t=d.indexOf(this);return d.splice(t,1)}Update(t){super.Update(t),this.renderRotation+=this.renderRotationSpeed*t;var e=this.angle/Math.PI*180;this.x+=Math.cos(e)*this.speed*t,this.y+=Math.sin(e)*this.speed*t,this.x<this.radius/2&&(this.x=s.width),this.x>s.width&&(this.x=this.radius),this.y<this.radius/2&&(this.y=s.height),this.y>s.height&&(this.y=this.radius)}Render(){super.Render(),i.strokeStyle=this.strokeColor,i.beginPath();let t=2*Math.PI/6;var e=this.angle/Math.PI*180+this.renderRotation;for(let s=0;s<6;s++)i.lineTo(this.x-this.radius*Math.cos(t*s+e),this.y-this.radius*Math.sin(t*s+e));i.closePath(),i.stroke()}}class P{constructor(){this.audioPlayers=[],this.isAudioEnabled=!0}CheckAudioEnabled(){return this.isAudioEnabled}ToggleAudioEnabled(t=!this.isAudioEnabled){this.isAudioEnabled=t}CreateSound(t,e=!1){const s=new b(t,e);return this.audioPlayers.push(s),s}CleanUp(t){if(t instanceof b){t.Remove();const e=this.audioPlayers.indexOf(t);-1!==e&&this.audioPlayers.splice(e,1)}else console.log("CleanUp Failed: Not an instanceof Sound.")}}class b{constructor(t,e=!1){const s={asteroidExplode:{soundFile:"./audio/space-explosion-with-reverb-101449.mp3",volPercent:40},gameOver:{soundFile:"./audio/game-fx-9-40197.mp3",volPercent:50},missionComplete:{soundFile:"./audio/game-level-complete-143022.mp3",volPercent:50},shieldDown:{soundFile:"./audio/one_beep-99630.mp3",volPercent:100},shipExplode:{soundFile:"./audio/heavy-cineamtic-hit-166888.mp3",volPercent:25},shipRespawn:{soundFile:"./audio/robot_01-47250.mp3",volPercent:50},shipThrusters:{soundFile:"./audio/thrusters_loopwav-14699.mp3",volPercent:100},shootBullet:{soundFile:"./audio/shoot02wav-14562.mp3",volPercent:10}};this.sound=new Audio(s[t].soundFile),this.sound.setAttribute("preload","auto"),this.sound.setAttribute("controls","none"),this.sound.style.display="none",document.body.appendChild(this.sound),this.SetVolume(s[t].volPercent),this.sound.loop=e}SetVolume(t){if(!(t>=0&&t<=100))return console.error("Invalid volume percentage. Please provide a value between 0 and 100.");this.sound.volume=t/100}Play(){if(o.CheckAudioEnabled())try{this.sound.play()}catch(t){console.error(`Error playing sound: ${t}`)}}Stop(){this.sound.pause()}Remove(){try{this.sound&&this.sound.addEventListener("ended",(()=>{this.sound&&this.sound.parentNode&&this.sound.parentNode.removeChild(this.sound)}))}catch(t){console.error(`Error removing sound: ${t}`)}}}class L extends y{constructor(t,e,s,i,h,o,r){super(t,e),this.color=s,this.velocityX=i,this.velocityY=h,this.size=o,this.lifespan=r,this.alpha=1}Update(t){this.x+=this.velocityX*t,this.y+=this.velocityY*t,this.alpha=Math.max(0,this.alpha-t/this.lifespan)}Render(){i.globalAlpha=this.alpha,i.fillStyle=this.color,i.beginPath(),i.arc(this.x,this.y,this.size,0,2*Math.PI),i.fill(),i.globalAlpha=1}GetAlpha(){return this.alpha}}class R extends y{constructor(t,e){super(t,e),this.particles=[],this.shouldEmit=!1,this.particlesPerSec=255,this.particleSize=2,this.particleColor="orange",this.particleLifespan=.1,this.particleSpeedMultiplier=.25,this.velX=0,this.velY=0}StartEmitting(){this.shouldEmit=!0}StopEmitting(){this.shouldEmit=!1}SetLocation(t,e,s,i){this.x=t,this.y=e,this.velX=s,this.velY=i}Update(t){if(this.shouldEmit){const e=Math.floor(this.particlesPerSec*t);for(let t=0;t<e;t++){const t=this.velX,e=this.velY,s=new L(this.x,this.y,this.particleColor,t*this.particleSpeedMultiplier,e*this.particleSpeedMultiplier,this.particleSize,this.particleLifespan);this.particles.push(s)}}for(const e of this.particles)e.Update(t);this.particles=this.particles.filter((t=>t.GetAlpha()>0))}Render(){for(const t of this.particles)t.Render()}Destroy(){f(R)}}class T extends y{constructor(t,e,s=10,i=1,h=["white"],o){super(t,e),this.particles=[],this.colors=h,this.particleCount=s,this.particleSize=i,this.particleLifespan=o;for(let t=0;t<this.particleCount;t++){const t=2*Math.random()*Math.PI,s=500*Math.random()+100,i=s*Math.cos(t),h=s*Math.sin(t),o=this.colors[Math.floor(Math.random()*this.colors.length)],r=new L(this.x,e,o,i,h,this.particleSize,this.particleLifespan);this.particles.push(r)}}Update(t){for(const e of this.particles)e.Update(t);if(this.particles=this.particles.filter((t=>t.GetAlpha()>0)),0==this.particles.length){const t=d.indexOf(this);return d.splice(t,1)}}Render(){for(const t of this.particles)t.Render()}}class k extends T{constructor(t,e){super(t,e,50,1.5,["white","white","white","white","red","pink","rgba(0, 255, 255, 1)"],2)}}})();